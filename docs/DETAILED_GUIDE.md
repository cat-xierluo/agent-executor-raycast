# Agent Executor è¯¦ç»†ä½¿ç”¨æŒ‡å—

æœ¬æ–‡æ¡£æä¾› Agent Executor Raycast æ‰©å±•çš„è¯¦ç»†è¯´æ˜å’Œé«˜çº§åŠŸèƒ½ä»‹ç»ã€‚

## ç›®å½•

- [åŠ¨æ€å‘½ä»¤ç³»ç»Ÿ](#-åŠ¨æ€å‘½ä»¤ç³»ç»Ÿ)
- [æ—¥å¿—ç³»ç»Ÿè¯¦è§£](#-æ—¥å¿—ç³»ç»Ÿè¯¦è§£)
- [çŠ¶æ€è¿½è¸ªç³»ç»Ÿ](#-çŠ¶æ€è¿½è¸ªç³»ç»Ÿ)
- [æŠ€æœ¯å®ç°ç»†èŠ‚](#-æŠ€æœ¯å®ç°ç»†èŠ‚)

---

## ğŸ“‹ åŠ¨æ€å‘½ä»¤ç³»ç»Ÿ

### å‘½ä»¤æ¥æº

æ‰€æœ‰å‘½ä»¤éƒ½ä» `.claude/commands/` ç›®å½•åŠ¨æ€åŠ è½½ï¼š

```
.claude/commands/
â”œâ”€â”€ deepresearch.md          # @include å¼•ç”¨å¤–éƒ¨æ–‡ä»¶
â”œâ”€â”€ sync-external.md         # @include å¼•ç”¨å¤–éƒ¨æ–‡ä»¶
â”œâ”€â”€ legal-router.md          # æœ¬åœ°å‘½ä»¤æ–‡ä»¶
â”œâ”€â”€ legal-preprocess.md
â”œâ”€â”€ legal-proposal.md
â”œâ”€â”€ legal-search.md
â””â”€â”€ legal-analyze.md
```

### @include æŒ‡ä»¤æ”¯æŒ

#### ç›¸å¯¹è·¯å¾„
```markdown
@include ../../SuitAgent/.claude/commands/deepresearch.md
```

#### ç»å¯¹è·¯å¾„(æ”¯æŒ ~/)
```markdown
@include ~/Library/Application Support/maoscripts/SuitAgent/.claude/commands/sync-external.md
```

### å‘½ä»¤å…ƒæ•°æ®æå–

æ‰©å±•ä¼šè‡ªåŠ¨ä»å‘½ä»¤æ–‡ä»¶ä¸­æå–:

1. **æ ‡é¢˜**:
   - ä¼˜å…ˆä½¿ç”¨ frontmatter ä¸­çš„ `name` å­—æ®µ
   - å…¶æ¬¡ä½¿ç”¨æ–‡ä»¶ä¸­ç¬¬ä¸€ä¸ªä¸€çº§æ ‡é¢˜ (`# æ ‡é¢˜`)
   - å¦åˆ™ä½¿ç”¨æ ¼å¼åŒ–çš„æ–‡ä»¶å

2. **æè¿°**:
   - ä¼˜å…ˆä½¿ç”¨ frontmatter ä¸­çš„ `description` å­—æ®µ
   - å…¶æ¬¡æŸ¥æ‰¾åŒ…å«"åŠŸèƒ½"ã€"æè¿°"ã€"è¯´æ˜"ç­‰å…³é”®è¯çš„è¡Œ
   - æˆ–è€…ä»¥ `>`, `**`, `*` å¼€å¤´çš„è¡Œ

3. **å›¾æ ‡**: æ ¹æ®å‘½ä»¤åç§°å…³é”®è¯æ™ºèƒ½åŒ¹é…

### Frontmatter æ ¼å¼

```markdown
---
name: æ·±åº¦ç ”ç©¶
description: å¯¹ç‰¹å®šä¸»é¢˜è¿›è¡Œæ·±åº¦ç ”ç©¶å’Œåˆ†æ
---

# æ·±åº¦ç ”ç©¶å‘½ä»¤

> åŠŸèƒ½:å¯¹ç‰¹å®šä¸»é¢˜è¿›è¡Œæ·±åº¦ç ”ç©¶...
```

---

## ğŸ“Š æ—¥å¿—ç³»ç»Ÿè¯¦è§£

### æ—¥å¿—ç›®å½•ç»“æ„

```
~/Library/Application Support/maoscripts/AutoWeave/agent-executor-raycast/logs/
â”œâ”€â”€ raycast-extension.jsonl  # JSONL æ ¼å¼çš„ç»“æ„åŒ–æ—¥å¿—ï¼ˆä¸»è¦æ—¥å¿—æ–‡ä»¶ï¼‰
â””â”€â”€ stats.json               # è¿è¡Œç»Ÿè®¡ä¿¡æ¯
```

**æ³¨æ„**ï¼šç³»ç»Ÿå·²å®Œå…¨è¿ç§»åˆ° JSONL-only æ—¥å¿—è®°å½•æ–¹å¼ã€‚ä¸å†ä½¿ç”¨ `runs/` ç›®å½•ã€`index.txt` æˆ– `errors.log` æ–‡ä»¶ã€‚

### æ—¥å¿—æŸ¥çœ‹

åœ¨ Raycast ä¸­è¿è¡Œ "æŸ¥çœ‹è¿è¡ŒçŠ¶æ€" å‘½ä»¤,å¯ä»¥:
- æŸ¥çœ‹æ‰€æœ‰è¿è¡Œå†å²
- æŒ‰æ—¶é—´å€’åºæ’åˆ—
- æŸ¥çœ‹æ¯æ¬¡è¿è¡Œçš„è¯¦ç»†ä¿¡æ¯
- å¤åˆ¶è¿è¡Œ ID
- åœ¨ Finder ä¸­æ‰“å¼€æ—¥å¿—æ–‡ä»¶

### æ—¥å¿—å†…å®¹

æ¯ä¸ªè¿è¡Œæ—¥å¿—åŒ…å«:
- Run ID(å”¯ä¸€æ ‡è¯†ç¬¦)
- è¿›ç¨‹ IDï¼ˆPIDï¼‰
- å¼€å§‹/ç»“æŸæ—¶é—´
- æ‰§è¡Œæ—¶é•¿
- ç›®æ ‡æ–‡ä»¶è·¯å¾„
- å·¥ä½œç›®å½•
- æ‰§è¡Œå‘½ä»¤
- å®Œæ•´è¾“å‡ºï¼ˆå®æ—¶è¾“å‡ºæµ + æœ€ç»ˆè¾“å‡ºï¼‰
- é€€å‡ºç 

### JSONL æ ¼å¼è¯´æ˜

**æ¯è¡Œä¸€ä¸ª JSON å¯¹è±¡**ï¼Œè¡¨ç¤ºä¸€æ¬¡è¿è¡Œçš„ä¸€ä¸ªäº‹ä»¶ã€‚æ‰€æœ‰æ—¥å¿—æŒ‰æ—¶é—´é¡ºåºè¿½åŠ åˆ°åŒä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚

#### å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `ts` | string | æ—¶é—´æˆ³ï¼Œæ ¼å¼ï¼š`YYYY-MM-DD HH:mm:ss` |
| `event` | string | äº‹ä»¶ç±»å‹ï¼ˆè§ä¸‹æ–¹äº‹ä»¶ç±»å‹ï¼‰ |
| `status` | string | çŠ¶æ€ï¼š`running` / `success` / `error` |
| `run_id` | string | å”¯ä¸€è¿è¡Œæ ‡è¯†ç¬¦ï¼Œæ ¼å¼ï¼š`run_YYYYMMDD_HHMMSS_PID` |
| `target` | string | ç›®æ ‡æ–‡ä»¶è·¯å¾„ |
| `work_dir` | string | å·¥ä½œç›®å½• |
| `cmd` | string | æ‰§è¡Œçš„å‘½ä»¤ |
| `pid` | number | è¿›ç¨‹ ID |
| `output` | string | å‘½ä»¤è¾“å‡ºï¼ˆå¯èƒ½è¢«æˆªæ–­ï¼‰ |
| `duration` | number | æ‰§è¡Œæ—¶é•¿ï¼ˆç§’ï¼‰ |
| `exit_code` | number | é€€å‡ºç ï¼ˆå¤±è´¥äº‹ä»¶ï¼‰ |

#### JSONL æ ¼å¼ç¤ºä¾‹

```json
{"ts":"2026-01-10 17:31:26","event":"started","status":"running","run_id":"run_20260110_173126_4093","target":"/path/to/file.pdf","work_dir":"/path/to"}
{"ts":"2026-01-10 17:31:27","event":"started_realtime","status":"running","run_id":"run_20260110_173126_4093","target":"/path/to/file.pdf","work_dir":"/path/to"}
{"ts":"2026-01-10 17:31:27","event":"executing","status":"running","run_id":"run_20260110_173126_4093","cmd":"/legal-router \"/path/to/file.pdf\"","pid":12345}
{"ts":"2026-01-10 17:31:28","event":"realtime_output","status":"running","run_id":"run_20260110_173126_4093","output":"æ­£åœ¨åˆ†ææ–‡ä»¶...","pid":12345}
{"ts":"2026-01-10 17:31:30","event":"realtime_output","status":"running","run_id":"run_20260110_173126_4093","output":"æ­£åœ¨ç”ŸæˆæŠ¥å‘Š...","pid":12345}
{"ts":"2026-01-10 17:31:59","event":"completed","status":"success","run_id":"run_20260110_173126_4093","duration":33.4,"pid":12345,"target":"/path/to/file.pdf","work_dir":"/path/to","cmd":"/legal-router \"/path/to/file.pdf\"","output":"è½¬æ¢å®Œæˆ..."}
```

### äº‹ä»¶ç±»å‹

| äº‹ä»¶ | è¯´æ˜ |
|------|------|
| `started` | å‘½ä»¤å¼€å§‹æ‰§è¡Œ |
| `started_realtime` | å®æ—¶æ—¥å¿—æµå¯åŠ¨ |
| `validated` | å‘½ä»¤å‚æ•°éªŒè¯é€šè¿‡ |
| `executing` | å‘½ä»¤æ­£åœ¨æ‰§è¡Œï¼ˆåŒ…å« PIDï¼‰ |
| `realtime_output` | å®æ—¶è¾“å‡ºç‰‡æ®µ |
| `completed` | å‘½ä»¤æˆåŠŸå®Œæˆ |
| `failed` | å‘½ä»¤æ‰§è¡Œå¤±è´¥ |

### æ—¥å¿—è¯»å–æ–¹å¼

**ç›´æ¥è¯»å– JSONL æ–‡ä»¶**ï¼š
```bash
# æŸ¥çœ‹æœ€è¿‘ 10 æ¡æ—¥å¿—
tail -n 10 ~/Library/Application\ Support/maoscripts/AutoWeave/agent-executor-raycast/logs/raycast-extension.jsonl

# æŸ¥çœ‹ç‰¹å®šè¿è¡Œçš„æ—¥å¿—
grep "run_20260110_173126_4093" ~/Library/Application\ Support/maoscripts/AutoWeave/agent-executor-raycast/logs/raycast-extension.jsonl | jq
```

**åœ¨ Raycast ä¸­æŸ¥çœ‹**ï¼š
- ä½¿ç”¨ "æŸ¥çœ‹è¿è¡ŒçŠ¶æ€" å‘½ä»¤ï¼Œç•Œé¢ä¼šè‡ªåŠ¨è§£æå’Œå±•ç¤º JSONL æ—¥å¿—

---

## ğŸ“Š çŠ¶æ€è¿½è¸ªç³»ç»Ÿ

### æ¦‚è¿°

çŠ¶æ€è¿½è¸ªç³»ç»Ÿæä¾›äº†å¯¹å‘½ä»¤æ‰§è¡Œå†å²çš„å®Œæ•´å¯è§†åŒ–ï¼Œè®©ä½ èƒ½å¤Ÿï¼š

- æŸ¥çœ‹æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å‘½ä»¤
- æµè§ˆæœ€è¿‘ 7 å¤©çš„å‘½ä»¤æ‰§è¡Œå†å²
- æŸ¥çœ‹æ¯æ¬¡è¿è¡Œçš„è¯¦ç»†æ—¥å¿—
- å¿«é€Ÿè¯Šæ–­å¤±è´¥å‘½ä»¤çš„åŸå› 

### è®¿é—®æ–¹å¼

çŠ¶æ€è¿½è¸ªé¡µé¢å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼è®¿é—®ï¼š

1. **ç‹¬ç«‹å‘½ä»¤**: åœ¨ Raycast ä¸­æœç´¢å¹¶è¿è¡Œ "è¿è¡ŒçŠ¶æ€" å‘½ä»¤
2. **ä»å‘½ä»¤åˆ—è¡¨è·³è½¬**: åœ¨å‘½ä»¤åˆ—è¡¨é¡µé¢æŒ‰ä¸‹ `Cmd+S` æˆ–ç‚¹å‡» "æŸ¥çœ‹è¿è¡ŒçŠ¶æ€"

### çŠ¶æ€åˆ†ç±»

çŠ¶æ€é¡µé¢å°†å‘½ä»¤æ‰§è¡Œè®°å½•åˆ†ä¸ºä¸‰ç±»ï¼š

#### æ­£åœ¨è¿è¡Œ (Running)

- æ˜¾ç¤ºæ‰€æœ‰æ­£åœ¨æ‰§è¡Œä¸­çš„å‘½ä»¤
- æ˜¾ç¤ºå‘½ä»¤å¼€å§‹æ—¶é—´
- æ¯ 5 ç§’è‡ªåŠ¨åˆ·æ–°çŠ¶æ€
- åªæ˜¾ç¤ºæœ€è¿‘ 1 å°æ—¶å†…å¼€å§‹è¿è¡Œçš„å‘½ä»¤ï¼ˆé¿å…åƒµå°¸è¿›ç¨‹ï¼‰

#### å·²å®Œæˆ (Completed)

- æ˜¾ç¤ºæœ€è¿‘ 7 å¤©å†…æˆåŠŸå®Œæˆçš„å‘½ä»¤
- æ˜¾ç¤ºå®Œæˆæ—¶é—´å’Œæ‰§è¡Œæ—¶é•¿
- å¯æŸ¥çœ‹å®Œæ•´æ—¥å¿—è¾“å‡º
- æ”¯æŒå¤åˆ¶å‘½ä»¤é‡æ–°æ‰§è¡Œ

#### å¤±è´¥ (Failed)

- æ˜¾ç¤ºæœ€è¿‘ 7 å¤©å†…æ‰§è¡Œå¤±è´¥çš„å‘½ä»¤
- æ˜¾ç¤ºé€€å‡ºç å’Œé”™è¯¯ä¿¡æ¯
- å¯æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
- å¿«é€Ÿè¯Šæ–­å¤±è´¥åŸå› 

### æ—¥å¿—è¯¦æƒ…

ç‚¹å‡»ä»»æ„å‘½ä»¤è®°å½•å¯ä»¥æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼ŒåŒ…æ‹¬ï¼š

- Run IDï¼ˆå”¯ä¸€æ ‡è¯†ç¬¦ï¼‰
- è¿›ç¨‹ IDï¼ˆPIDï¼‰
- å®Œæ•´å‘½ä»¤å­—ç¬¦ä¸²
- ç›®æ ‡æ–‡ä»¶è·¯å¾„
- å¼€å§‹/ç»“æŸæ—¶é—´
- æ‰§è¡Œæ—¶é•¿
- å®Œæ•´è¾“å‡ºå†…å®¹
- é€€å‡ºç ï¼ˆå¤±è´¥å‘½ä»¤ï¼‰

**å®æ—¶æ—¥å¿—æµ**ï¼š
- æ­£åœ¨è¿è¡Œçš„å‘½ä»¤ä¼šå®æ—¶å†™å…¥æ—¥å¿—æ–‡ä»¶
- æŸ¥çœ‹è¿è¡Œä¸­å‘½ä»¤çš„æ—¥å¿—æ—¶ï¼Œé¡µé¢æ¯ 2 ç§’è‡ªåŠ¨åˆ·æ–°
- å¯ä»¥çœ‹åˆ°å‘½ä»¤çš„å®æ—¶è¾“å‡ºï¼Œæ— éœ€ç­‰å¾…å‘½ä»¤å®Œæˆ
- è¿›ç¨‹ ID å¯ä»¥ç”¨äºå¼ºåˆ¶ç»ˆæ­¢å¡æ­»çš„å‘½ä»¤ï¼ˆä½¿ç”¨ `kill <PID>`ï¼‰

### æŠ€æœ¯å®ç°

çŠ¶æ€è¿½è¸ªç³»ç»ŸåŸºäºä»¥ä¸‹æŠ€æœ¯ï¼š

- **æ—¥å¿—æº**: ä» `agent-executor.jsonl` è¯»å–ç»“æ„åŒ–æ—¥å¿—
- **çŠ¶æ€è¯†åˆ«**: æ ¹æ® `event` å­—æ®µï¼ˆstarted/executing/completed/failedï¼‰ç¡®å®šå‘½ä»¤çŠ¶æ€
- **æ—¶é—´è¿‡æ»¤**: è‡ªåŠ¨æ¸…ç†è¶…è¿‡ 7 å¤©çš„è®°å½•
- **è‡ªåŠ¨åˆ·æ–°**: æ¯ 5 ç§’æ›´æ–°ä¸€æ¬¡çŠ¶æ€ï¼ˆä»…åœ¨çŠ¶æ€é¡µé¢æ‰“å¼€æ—¶ï¼‰

### è®¾è®¡åŸåˆ™

1. **ç®€å•é«˜æ•ˆ**: ä¸ç»´æŠ¤é¢å¤–çš„çŠ¶æ€å­˜å‚¨ï¼Œç›´æ¥è¯»å–æ—¥å¿—æ–‡ä»¶
2. **è·¨è¿›ç¨‹æ”¯æŒ**: å¤šä¸ªå‘½ä»¤å®ä¾‹åŒæ—¶è¿è¡Œæ—¶éƒ½èƒ½è¢«æ­£ç¡®è¿½è¸ª
3. **è‡ªåŠ¨æ¸…ç†**: è‡ªåŠ¨è¿‡æ»¤æ—§è®°å½•ï¼Œé¿å…åˆ—è¡¨è¿‡é•¿
4. **å¯æ‰©å±•æ€§**: æ¶æ„è®¾è®¡æ”¯æŒæœªæ¥æ·»åŠ æ›´å¤šçŠ¶æ€å’Œè¿‡æ»¤é€‰é¡¹

---

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### æ ¸å¿ƒä»£ç ä½ç½®

- **å‘½ä»¤æ‰«æ**: [src/utils/commands.ts:127](src/utils/commands.ts#L127) - æ‰«æå¹¶è®°å½• `projectDir`
- **å‚æ•°æ„å»º**: [src/commands.tsx:339](src/commands.tsx#L339) - ä½¿ç”¨ `command.projectDir`
- **æ–‡ä»¶è·¯å¾„å¤„ç†**: [src/commands.tsx:323](src/commands.tsx#L323) - ç”¨å¼•å·åŒ…è£¹æ–‡ä»¶è·¯å¾„
- **å®é™…æ‰§è¡Œ**: [src/utils/claude.ts:140](src/utils/claude.ts#L140) - è®¾ç½® `cwd` å¹¶ä¼ é€’ prompt

### æ‰§è¡Œæµç¨‹

1. **å‘½ä»¤æ‰«æï¼ˆåº”ç”¨å¯åŠ¨æ—¶ï¼‰**
   ```typescript
   // æ‰«ææ‰€æœ‰é…ç½®çš„é¡¹ç›®ç›®å½•
   scanCommands([
     "~/maoscripts/AutoWeave",
     "~/maoscripts/SuitAgent"
   ])
   // â†’ å‘ç° AutoWeave/.claude/commands/deepresearch.md
   // â†’ è®°å½•å‘½ä»¤æ‰€å±çš„é¡¹ç›®ç›®å½•
   ```

2. **æ„å»ºæ‰§è¡Œå‚æ•°**
   ```typescript
   {
     prompt: "/deepresearch \"~/Documents/cases/case001.pdf\"",  // å‘½ä»¤ + æ–‡ä»¶è·¯å¾„
     projectDir: "~/maoscripts/AutoWeave"  // å‘½ä»¤æ‰€å±é¡¹ç›®
   }
   ```

3. **åç«¯å®é™…æ‰§è¡Œ**
   ```typescript
   const child = spawn(claudeBin, [
     "--print",
     "--dangerously-skip-permissions",
     "/deepresearch \"~/Documents/cases/case001.pdf\"",  // å‘½ä»¤ + æ–‡ä»¶è·¯å¾„
   ], {
     cwd: "~/maoscripts/AutoWeave"     // è®¾ç½®è¿›ç¨‹å·¥ä½œç›®å½•
   });
   ```

### å¤šé¡¹ç›®æ”¯æŒ

å½“ä½ é…ç½®äº†å¤šä¸ªé¡¹ç›®ç›®å½•æ—¶ï¼š

```javascript
é…ç½®çš„é¡¹ç›®ç›®å½• = [
  "~/maoscripts/AutoWeave",
  "~/maoscripts/SuitAgent"
]

// å½“ä½ æ‰§è¡Œ deepresearch å‘½ä»¤æ—¶ï¼ˆæ¥è‡ª AutoWeaveï¼‰
{
  prompt: "/deepresearch \"~/Documents/cases/case001.pdf\"",
  projectDir: "~/maoscripts/AutoWeave"   // è‡ªåŠ¨ä½¿ç”¨å‘½ä»¤æ‰€å±çš„é¡¹ç›®
}

// å½“ä½ æ‰§è¡Œ 2word å‘½ä»¤æ—¶ï¼ˆæ¥è‡ª SuitAgentï¼‰
{
  prompt: "/2word \"~/Documents/cases/case001.pdf\"",
  projectDir: "~/maoscripts/SuitAgent"   // è‡ªåŠ¨ä½¿ç”¨å‘½ä»¤æ‰€å±çš„é¡¹ç›®
}
```

**å…³é”®ç‚¹**ï¼š
- âœ… æ¯ä¸ªå‘½ä»¤è‡ªåŠ¨åœ¨å…¶æ‰€å±çš„é¡¹ç›®ç›®å½•ä¸­æ‰§è¡Œ
- âœ… æ–‡ä»¶è·¯å¾„åœ¨ prompt ä¸­ä¼ é€’ï¼ˆç”¨å¼•å·åŒ…è£¹ï¼‰
- âœ… æ— éœ€æ‰‹åŠ¨æŒ‡å®šï¼Œç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«
- âœ… æ”¯æŒè·¨é¡¹ç›®å‘½ä»¤åä½œ

---

## ğŸ¯ è®¾è®¡åŸåˆ™

1. **åŠ¨æ€ä¼˜äºé™æ€**: æ‰€æœ‰å‘½ä»¤é€šè¿‡æ‰«æç”Ÿæˆ,ä¸ç¡¬ç¼–ç 
2. **å•ä¸€å…¥å£**: åªæœ‰ä¸€ä¸ªå‘½ä»¤åˆ—è¡¨å…¥å£,æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤
3. **æ™ºèƒ½æå–**: è‡ªåŠ¨ä»å‘½ä»¤æ–‡ä»¶ä¸­æå–å…ƒæ•°æ®
4. **@include æ”¯æŒ**: å®Œæ•´æ”¯æŒå‘½ä»¤æ–‡ä»¶å¼•ç”¨æœºåˆ¶
5. **é›¶é…ç½®æ·»åŠ **: æ·»åŠ æ–°å‘½ä»¤åªéœ€åˆ›å»º `.md` æ–‡ä»¶
